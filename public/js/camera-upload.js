/*! For license information please see camera-upload.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function s(t,a,o,i){var s=a&&a.prototype instanceof l?a:l,c=Object.create(s.prototype);return n(c,"_invoke",function(t,n,a){var o,i,s,l=0,c=a||[],u=!1,m={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return o=t,i=0,s=e,m.n=n,d}};function h(t,n){for(i=t,s=n,r=0;!u&&l&&!a&&r<c.length;r++){var a,o=c[r],h=m.p,v=o[2];t>3?(a=v===n)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=h&&((a=t<2&&h<o[1])?(i=0,m.v=n,m.n=o[1]):h<v&&(a=t<3||o[0]>n||n>v)&&(o[4]=t,o[5]=n,m.n=v,i=0))}if(a||t>1)return d;throw u=!0,n}return function(a,c,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===c&&h(c,v),i=c,s=v;(r=i<2?e:s)||!u;){o||(i?i<3?(i>1&&(m.n=-1),h(i,s)):m.n=s:m.v=s);try{if(l=2,o){if(i||(a="next"),r=o[a]){if(!(r=r.call(o,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=o.return)&&r.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((r=(u=m.n<0)?s:t.call(n,m))!==d)break}catch(t){o=e,i=1,s=t}finally{l=1}}return{value:r,done:u}}}(t,o,i),!0),c}var d={};function l(){}function c(){}function u(){}r=Object.getPrototypeOf;var m=[][o]?r(r([][o]())):(n(r={},o,function(){return this}),r),h=u.prototype=l.prototype=Object.create(m);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,n(h,"constructor",u),n(u,"constructor",c),c.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(h),n(h,i,"Generator"),n(h,o,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:v}})()}function n(e,t,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}n=function(e,t,r,a){if(t)o?o(e,t,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[t]=r;else{var i=function(t,r){n(e,t,function(e){return this._invoke(t,r,e)})};i("next",0),i("throw",1),i("return",2)}},n(e,t,r,a)}function r(e,t,n,r,a,o,i){try{var s=e[o](i),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function s(e){r(i,a,o,s,d,"next",e)}function d(e){r(i,a,o,s,d,"throw",e)}s(void 0)})}}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=document.getElementById("cameraUploadModal"),this.video=document.getElementById("cameraPreview"),this.canvas=document.getElementById("captureCanvas"),this.context=this.canvas.getContext("2d"),this.gallerySelect=document.getElementById("gallerySelect"),this.cameraError=document.getElementById("cameraError"),this.stream=null,this.capturedImage=null,this.initEventListeners(),this.loadGalleries()},n=[{key:"initEventListeners",value:function(){var e,t,n,r,a,o,i,s,d=this;null===(e=document.getElementById("cameraUploadBtn"))||void 0===e||e.addEventListener("click",function(){return d.openModal()}),null===(t=document.getElementById("cameraUploadBtnMobile"))||void 0===t||t.addEventListener("click",function(){return d.openModal()}),null===(n=document.getElementById("closeCameraModal"))||void 0===n||n.addEventListener("click",function(){return d.closeModal()}),null===(r=document.getElementById("startCameraBtn"))||void 0===r||r.addEventListener("click",function(){return d.startCamera()}),null===(a=document.getElementById("captureBtn"))||void 0===a||a.addEventListener("click",function(){return d.capturePhoto()}),null===(o=document.getElementById("retakeBtn"))||void 0===o||o.addEventListener("click",function(){return d.retakePhoto()}),null===(i=document.getElementById("uploadBtn"))||void 0===i||i.addEventListener("click",function(){return d.uploadPhoto()}),null===(s=this.modal)||void 0===s||s.addEventListener("click",function(e){e.target===d.modal&&d.closeModal()})}},{key:"loadGalleries",value:(d=a(t().m(function e(){var n,r,a,o;return t().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/camera-upload/galleries",{headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(null===(n=document.querySelector('meta[name="csrf-token"]'))||void 0===n?void 0:n.content)||""}});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("Failed to load galleries");case 2:return e.n=3,r.json();case 3:a=e.v,this.populateGalleries(a.galleries),e.n=5;break;case 4:e.p=4,o=e.v,console.error("Error loading galleries:",o),this.gallerySelect.innerHTML='<option value="">Error loading galleries</option>';case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return d.apply(this,arguments)})},{key:"populateGalleries",value:function(e){var t=this;this.gallerySelect.innerHTML='<option value="">Select a gallery...</option>',e.forEach(function(e){var n=document.createElement("option");n.value=e.id,n.textContent=e.name,t.gallerySelect.appendChild(n)})}},{key:"openModal",value:function(){this.modal.classList.remove("hidden"),document.body.style.overflow="hidden"}},{key:"closeModal",value:function(){this.modal.classList.add("hidden"),document.body.style.overflow="",this.stopCamera(),this.resetUI()}},{key:"startCamera",value:(s=a(t().m(function e(){var n,r;return t().w(function(e){for(;;)switch(e.n){case 0:if(e.p=0,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.n=1;break}throw new Error("Camera not supported by this browser");case 1:return n={video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}},/iPad|iPhone|iPod/.test(navigator.userAgent)&&(n.video.width={ideal:1920,max:1920},n.video.height={ideal:1080,max:1080}),e.n=2,navigator.mediaDevices.getUserMedia(n);case 2:this.stream=e.v,this.video.srcObject=this.stream,this.video.play(),this.video.classList.remove("hidden"),this.cameraError.classList.add("hidden"),document.getElementById("startCameraBtn").classList.add("hidden"),document.getElementById("captureBtn").classList.remove("hidden"),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error accessing camera:",r),this.showCameraError("Unable to access camera. Please ensure you have granted camera permissions.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return s.apply(this,arguments)})},{key:"stopCamera",value:function(){this.stream&&(this.stream.getTracks().forEach(function(e){return e.stop()}),this.stream=null)}},{key:"capturePhoto",value:function(){this.stream&&(this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight,this.context.drawImage(this.video,0,0),this.capturedImage=this.canvas.toDataURL("image/jpeg",.9),this.video.classList.add("hidden"),this.canvas.classList.remove("hidden"),document.getElementById("captureBtn").classList.add("hidden"),document.getElementById("retakeBtn").classList.remove("hidden"),document.getElementById("uploadBtn").classList.remove("hidden"),this.stopCamera())}},{key:"retakePhoto",value:function(){this.capturedImage=null,this.canvas.classList.add("hidden"),document.getElementById("retakeBtn").classList.add("hidden"),document.getElementById("uploadBtn").classList.add("hidden"),document.getElementById("startCameraBtn").classList.remove("hidden")}},{key:"uploadPhoto",value:(i=a(t().m(function e(){var n,r,a,o,i,s,d;return t().w(function(e){for(;;)switch(e.n){case 0:if(this.capturedImage){e.n=1;break}return alert("No photo captured"),e.a(2);case 1:if(this.gallerySelect.value){e.n=2;break}return alert("Please select a gallery"),e.a(2);case 2:return n=document.getElementById("uploadProgress"),r=document.getElementById("uploadProgressBar"),e.p=3,n.classList.remove("hidden"),r.style.width="10%",(o=new FormData).append("gallery_id",this.gallerySelect.value),o.append("photo",this.capturedImage),o.append("name","Camera Upload ".concat((new Date).toLocaleString())),r.style.width="30%",e.n=4,fetch("/camera-upload/upload",{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(null===(a=document.querySelector('meta[name="csrf-token"]'))||void 0===a?void 0:a.content)||""}});case 4:if(i=e.v,r.style.width="70%",i.ok){e.n=5;break}throw new Error("Upload failed");case 5:return e.n=6,i.json();case 6:if(s=e.v,r.style.width="100%",!s.success){e.n=7;break}alert("Photo uploaded successfully to ".concat(s.photo.gallery,"!")),this.closeModal(),window.location.pathname.includes("/galleries/")&&window.location.reload(),e.n=8;break;case 7:throw new Error(s.message||"Upload failed");case 8:e.n=10;break;case 9:e.p=9,d=e.v,console.error("Upload error:",d),alert("Failed to upload photo: "+d.message);case 10:return e.p=10,n.classList.add("hidden"),r.style.width="0%",e.f(10);case 11:return e.a(2)}},e,this,[[3,9,10,11]])})),function(){return i.apply(this,arguments)})},{key:"showCameraError",value:function(e){this.cameraError.classList.remove("hidden"),this.cameraError.querySelector("p").textContent=e,this.video.classList.add("hidden")}},{key:"resetUI",value:function(){this.video.classList.add("hidden"),this.canvas.classList.add("hidden"),this.cameraError.classList.add("hidden"),document.getElementById("startCameraBtn").classList.remove("hidden"),document.getElementById("captureBtn").classList.add("hidden"),document.getElementById("retakeBtn").classList.add("hidden"),document.getElementById("uploadBtn").classList.add("hidden"),document.getElementById("uploadProgress").classList.add("hidden"),this.capturedImage=null}}],n&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s,d}();document.addEventListener("DOMContentLoaded",function(){document.getElementById("cameraUploadModal")&&new s})})();